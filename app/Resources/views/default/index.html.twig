{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
<link href="assets/css/themify-icons.css" rel="stylesheet">

{% endblock  %}

{% block body %}
    <div class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6 col-sm-6 col-lg-offset-3">
                    <div class="card">
                        <div class="content">
                            <div class="row">
                                <h4 class="text-center">Cierre de caja</h4>
                                    <div class="text-center">
                                        <a onclick="exportPdfCierreCaja()" class="btn btn-primary">Exportar Pdf</a>
                                    </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-sm-6 col-lg-offset-3">
                    <div class="card">
                        <div class="content">
                            <div class="row">
                                <h4 class="text-center">Productos</h4>
                                <div class="text-center">
                                    <a onclick="exportPdfCierreProducto()" class="btn btn-primary">Exportar Pdf</a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-sm-6 col-lg-offset-3">
                    <div class="card">
                        <div class="content">
                            <div class="row">
                                <div class="col-xs-5">
                                    <div class="icon-big icon-warning text-center">
                                        <i class="ti-server"></i>
                                    </div>
                                </div>
                                <div class="col-xs-7">
                                    <div class="numbers">
                                        <p>Ventas del mes</p>
                                        <span id="ventas"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="footer">
                                <hr />
                                <div class="stats">
                                    <i class="ti-calendar"></i> {{ "now"|date("M/Y", "America/Argentina/Cordoba") }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 ">
                    <div class="card">
                        <div class="content">
                            <div class="row">
                                <div class="col-xs-5">
                                    <div class="icon-big icon-success text-center">
                                        <i class="ti-wallet"></i>
                                    </div>
                                </div>
                                <div class="col-xs-7">
                                    <div class="numbers">
                                        <p>Compras del mes</p>
                                        <span id="compras"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="footer">
                                <hr />
                                <div class="stats">
                                    <i class="ti-calendar"></i>{{ "now"|date("M/Y", "America/Argentina/Cordoba") }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-lg-3 col-sm-6 col-lg-offset-3">
                    <div class="card">
                        <div class="content">
                            <div class="row">
                                <div class="col-xs-5">
                                    <div class="icon-big icon-info text-center">
                                        <i class="ti-calendar"></i>
                                    </div>
                                </div>
                                <div class="col-xs-7">
                                    <div class="numbers">
                                        <p>Ventas del Día</p>
                                        <span id="ventasDia"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="footer">
                                <hr />
                                <div class="stats">
                                    <i class="ti-timer"></i> {{ "now"|date("d/m/Y") }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="card">
                        <div class="content">
                            <div class="row">
                                <div class="col-xs-5">
                                    <div class="icon-big icon-danger text-center">
                                        <i class="ti-calendar"></i>
                                    </div>
                                </div>
                                <div class="col-xs-7">
                                    <div class="numbers">
                                        <p>Compras del Día</p>
                                        <span id="comprasDia"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="footer">
                                <hr />
                                <div class="stats">
                                    <i class="ti-timer"></i> {{ "now"|date("d/m/Y") }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 col-lg-offset-3">
                    <div class="card ">
                        <div class="header">
                            <h4 class="title">Ventas del {{ "now"|date("Y") }} de productos </h4>
                            <p class="category"><br></p>
                            <div class="col-md-4 pull-right">
                                <div class="form-group text-center">
                                    <label>Producto:</label>
                                    <select onchange="SelectProducto()" class="form-control border-input" name="" id="producto">
                                        <option value=""></option>

                                        {% for producto in productos %}
                                            <option class="text-capitalize" value="{{ producto.id }}">{{ producto.codigo  }} -{{ producto.titulo  }}- {{ producto.tipoUnidad.tipo }}</option>

                                        {% endfor %}

                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <div id="chartActivity" class="ct-chart"></div>

                            <div class="footer">
                                <div class="chart-legend">
                                    <i  class="fa fa-circle text-info"></i> Cantidad Vendida
                                    <i class="fa fa-circle text-warning"></i>Dinero por Mes
                                </div>
                                <hr>
                                <div class="stats">
                                    {#<i class="ti-check"></i> Data information certified#}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                {#<div class="col-md-6">#}
                    {#<div class="card">#}
                        {#<div class="header">#}
                            {#<h4 class="title">Email Statistics</h4>#}
                            {#<p class="category">Last Campaign Performance</p>#}
                        {#</div>#}
                        {#<div class="content">#}
                            {#<div id="chartPreferences" class="ct-chart ct-perfect-fourth"></div>#}

                            {#<div class="footer">#}
                                {#<div class="chart-legend">#}
                                    {#<i class="fa fa-circle text-info"></i> Open#}
                                    {#<i class="fa fa-circle text-danger"></i> Bounce#}
                                    {#<i class="fa fa-circle text-warning"></i> Unsubscribe#}
                                {#</div>#}
                                {#<hr>#}
                                {#<div class="stats">#}
                                    {#<i class="ti-timer"></i> Campaign sent 2 days ago#}
                                {#</div>#}
                            {#</div>#}
                        {#</div>#}
                    {#</div>#}
                {#</div>#}

            </div>
        </div>
    </div>



    </div>
    </div>
    <script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>

    <!--  Checkbox, Radio & Switch Plugins -->

    <!--  Charts Plugin -->
    <script src="assets/js/chartist.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function(){

            demo.initChartist();

            $.notify({
                icon: 'ti-gift',
                message: "<b>Bienvenido a BENIAR sitemas</b> "

            },{
                type: 'success',
                timer: 4000
            });

        });
    </script>
{% endblock %}
{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).ready(function() { $("#producto").select2(); });
        var fecha = new Date();
        var a = fecha.getFullYear();
        var m= fecha.getMonth()+1;
        var d= fecha.getDate();

        //VENTAS POR MES
        $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: "{{ path ("grafico_ventas_mes") }}",
                data: {mes:m,anio:a}
            }).done(function (data) {
                $('#ventas').text('$' + Math.round(data[0].total * 100) / 100)
            });
        });

        //COMPRAS POR MES
        $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: "{{ path ("grafico_compras_mes") }}",
                data: {mes:m,anio:a}
            }).done(function (data) {
                $('#compras').text('$' +Math.round(data[0].total* 100) / 100)
            });
        });
        //VENTAS POR DIA
        $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: "{{ path ("grafico_ventas_dia") }}",
                data: {mes:m,anio:a,dia:d}
            }).done(function (data) {
                $('#ventasDia').text('$' +Math.round(data[0].total* 100) / 100)
            });
        });

        //COMPRAS POR DIA
        $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: "{{ path ("grafico_compras_dia") }}",
                data: {mes:m,anio:a,dia:d}
            }).done(function (data) {
                $('#comprasDia').text('$'+Math.round( data[0].total* 100) / 100)
            });
        });



        function SelectProducto() {
            var idProducto=$('#producto').val();

            $(document).ready(function () {
                $.ajax({
                    type: "POST",
                    url: "{{ path ("grafico_producto_ventas") }}",
                    data: {idProducto:idProducto,anio:a}
                }).done(function (data) {
                    console.log(data);
                    var meses=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                    var dinero=[0,0,0,0,0,0,0,0,0,0,0,0,0];
                    for (var i = 0; i < data.length; i++) {
                        meses[data[i].mes]=data[i].cantidad;
                        dinero[data[i].mes]=data[i].total;

                    }
                        console.log(meses);


                        var data = {
                            labels: ['Enero', 'Feb', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Sep', 'Oct', 'Nov', 'Dec'],
                            series: [
                                [ meses[1], meses[2], meses[3], meses[4], meses[5],meses[6], meses[7], meses[8],meses[9], meses[10], meses[11],meses[12]],
                                [ dinero[1], dinero[2], dinero[3], dinero[4], dinero[5],dinero[6], dinero[7], dinero[8],dinero[9], dinero[10], dinero[11],dinero[12]],

                            ]
                        };

                        var options = {
                            seriesBarDistance: 10,
                            axisX: {
                                showGrid: false
                            },
                            height: "245px"
                        };

                        var responsiveOptions = [
                            ['screen and (max-width: 640px)', {
                                seriesBarDistance: 5,
                                axisX: {
                                    labelInterpolationFnc: function (value) {
                                        return value[0];
                                    }
                                }
                            }]
                        ];

                        Chartist.Line('#chartActivity', data, options, responsiveOptions);

                });
            });

        }
        function exportPdfCierreCaja() {
            window.location.href = "http://127.0.0.1:8000/pdfCierreCaja/"+a+"/"+m+"/"+d;

        }
        function exportPdfCierreProducto() {
            window.location.href = "http://127.0.0.1:8000/pdfCierreProducto/"+a+"/"+m+"/"+d;

        }
    </script>

{% endblock %}
